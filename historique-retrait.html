<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Historique des retraits</title>
<style>
:root {
    --primary-color: #4A90E2;
    --primary-light: #D0E6FA;
    --accent-color: #FF6B6B;
    --success-color: #4CAF50;
    --text-color: #333;
    --text-light: #666;
    --background-color: #F0F4F8;
    --card-background: #fff;
    --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
    --transition-speed: 0.3s;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: Arial, sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height:1.5;
}

.header {
    padding: 16px;
    background-color: var(--primary-color);
    display: flex;
    align-items: center;
    position: sticky;
    top:0;
    z-index:100;
    color:white;
    font-weight:600;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    border-bottom-left-radius:12px;
    border-bottom-right-radius:12px;
}

.back-arrow {
    width:36px; height:36px;
    display:flex; justify-content:center; align-items:center;
    border-radius:50%; margin-right:12px; cursor:pointer;
    transition: background var(--transition-speed);
}

.back-arrow:hover { background-color: rgba(255,255,255,0.2); }

.header h1 { font-size:20px; }

#history-container { padding:16px; max-width:480px; margin:0 auto; }

.card {
    background: var(--card-background);
    margin-bottom:16px;
    padding:18px;
    border-radius:12px;
    box-shadow: var(--card-shadow);
    border-left: 5px solid var(--primary-color);
    transition: all var(--transition-speed);
}

.card:hover { transform: translateY(-3px); box-shadow:0 6px 16px rgba(0,0,0,0.15); }

.row { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.row:last-child { margin-bottom:0; }

.label { font-size:13px; color: var(--text-light); }
.value { font-size:14px; font-weight:600; }

.blue-text { color: var(--primary-color); }
.orange-text { color: var(--accent-color); }
.green-text { color: var(--success-color); }

.badge {
    padding: 3px 8px;
    border-radius:12px;
    font-size:12px;
    font-weight:600;
    color:white;
    text-transform:capitalize;
}

.badge-success { background-color: var(--success-color); }
.badge-pending { background-color: var(--accent-color); }
.badge-failed { background-color: #FF3B30; }

.no-history {
    text-align:center;
    padding:40px 20px;
    color: var(--text-light);
    font-size:15px;
    background: var(--card-background);
    border-radius:12px;
    box-shadow: var(--card-shadow);
}

/* Responsive */
@media(max-width:480px){
    .card{ padding:14px; }
    .label{ font-size:12px; }
    .value{ font-size:13px; }
    .header h1{ font-size:18px; }
}
</style>
</head>
<body>
<div class="header">
    <div class="back-arrow"><span>&larr;</span></div>
    <h1>Historique des retraits</h1>
</div>

<div id="history-container"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

// --- Firebase config ---
const firebaseConfig = {
    apiKey: "AIzaSyC_el0Jffzw91JwWnvzIwYTOGk4MexLPik",
    authDomain: "lipton-4f24a.firebaseapp.com",
    databaseURL: "https://lipton-4f24a-default-rtdb.firebaseio.com",
    projectId: "lipton-4f24a",
    storageBucket: "lipton-4f24a.firebasestorage.app",
    messagingSenderId: "1041905353994",
    appId: "1:1041905353994:web:cb3de8068c56cac54766f3"
};

// --- Init Firebase ---
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

// --- Utils ---
function formatAmount(amount) { return `${amount.toLocaleString('fr-FR')} FCFA`; }
function formatDate(ts) { return new Date(ts).toLocaleString('fr-FR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}); }

// --- Badge statut ---
function statusBadge(status){
    if(status.toLowerCase() === 'terminé') return `<span class="badge badge-success">${status}</span>`;
    if(status.toLowerCase() === 'en attente') return `<span class="badge badge-pending">${status}</span>`;
    return `<span class="badge badge-failed">${status}</span>`;
}

// --- Create card ---
function createWithdrawalCard(w) {
    return `
    <div class="card">
        <div class="row"><span class="label">Montant retiré</span><span class="value">− ${formatAmount(w.amount)}</span></div>
        <div class="row"><span class="label">Date de retrait</span><span class="value">${formatDate(w.timestamp)}</span></div>
        <div class="row"><span class="label">Statut</span><span class="value">${statusBadge(w.status)}</span></div>
        <div class="row"><span class="label">Montant a recevoir</span><span <span class="value orange-text">${formatAmount(w.amount - (w.fees || 0))}</span></div>
    </div>`;
}

// --- Display history ---
function displayWithdrawalHistory(history){
    const container = document.getElementById('history-container');
    if(!history || Object.keys(history).length===0){
        container.innerHTML='<div class="no-history">Aucun retrait disponible</div>';
        return;
    }
    container.innerHTML='';
    Object.entries(history)
        .sort(([,a],[,b])=>b.timestamp-a.timestamp)
        .forEach(([,w])=>{
            container.innerHTML+=createWithdrawalCard(w);
        });
}

// --- Auth ---
onAuthStateChanged(auth,user=>{
    if(user){
        const historyRef = ref(database,`users/${user.uid}/withdrawalHistory`);
        onValue(historyRef,snapshot=>{
            displayWithdrawalHistory(snapshot.val());
        });
    } else { window.location.href='login.html'; }
});

// --- Back button ---
document.querySelector('.back-arrow').addEventListener('click',()=>history.back());
</script>
</body>
</html>
